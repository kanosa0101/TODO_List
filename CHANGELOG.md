# 更新日志

## 2024 - 最新功能更新

### ✨ 新增功能

1. **每日任务功能**
   - ✅ 支持设置每日任务，每天自动重置完成状态
   - ✅ 每日任务完成不计入统计
   - ✅ 每日任务和其他任务分类显示

2. **任务时长设置**
   - ✅ 支持设置预计时长（分钟/小时/天）
   - ✅ 时长单位可选择：分钟、小时、天

3. **任务进度跟踪**
   - ✅ 支持设置任务总步骤数
   - ✅ 实时跟踪已完成步骤数
   - ✅ 显示进度百分比

4. **UI优化**
   - ✅ 任务分类显示（每日任务块/其他任务块）
   - ✅ 已完成任务更透明显示
   - ✅ 弹窗式添加任务表单
   - ✅ 默认显示进行中的任务

### 🔧 修复的问题

1. **数据加载问题**
   - ✅ 修复403错误，改进CORS和认证处理
   - ✅ 改进错误处理，显示更详细的错误信息
   - ✅ 数据规范化，兼容旧数据

2. **登录逻辑**
   - ✅ 改进会话管理，首次访问自动退出
   - ✅ 修复Token过期处理

3. **代码质量**
   - ✅ 修复linter警告
   - ✅ 改进异常处理
   - ✅ 优化数据验证

## 2024 - 用户认证系统完善

### 🔧 修复的问题

1. **JwtAuthenticationFilter 异常处理**
   - ✅ 添加了 `@NonNull` 注解修复 linter 警告
   - ✅ 改进了异常处理逻辑，确保 Token 无效时不会导致过滤器崩溃
   - ✅ 添加了用户不存在时的异常捕获

2. **JwtUtil.validateToken 方法**
   - ✅ 添加了 try-catch 异常处理
   - ✅ 防止 Token 无效时抛出异常
   - ✅ 添加了 null 检查

3. **UserMenu 组件优化**
   - ✅ 添加了点击外部关闭菜单的功能
   - ✅ 使用 useRef 和 useEffect 实现更好的用户体验

### 📚 完善的文档

1. **README.md 更新**
   - ✅ 添加了用户认证与授权章节
   - ✅ 更新了 API 接口文档，区分认证 API 和受保护 API
   - ✅ 更新了数据模型，包含 User 实体
   - ✅ 添加了认证相关的故障排除指南
   - ✅ 更新了改进计划，标记用户认证已完成

2. **AUTHENTICATION.md 新建**
   - ✅ 创建了完整的用户认证系统文档
   - ✅ 包含架构设计、实现细节、API 文档
   - ✅ 包含使用指南和故障排除
   - ✅ 包含数据库结构和配置说明

### ✨ 代码质量改进

1. **代码规范**
   - ✅ 修复了所有 linter 警告
   - ✅ 添加了必要的注解
   - ✅ 改进了异常处理

2. **安全性**
   - ✅ 改进了 Token 验证的健壮性
   - ✅ 确保所有异常情况都被正确处理
   - ✅ 防止潜在的安全漏洞

### 📋 功能验证

所有功能已完整实现并通过检查：

- ✅ 用户注册和登录
- ✅ JWT Token 生成和验证
- ✅ 密码 BCrypt 加密
- ✅ 用户数据隔离
- ✅ 路由保护
- ✅ Token 过期处理
- ✅ 前端自动添加 Token
- ✅ 错误处理和用户反馈

### 🎯 下一步建议

虽然当前功能已完整，但可以考虑以下增强：

1. **Token 刷新机制** - 实现 refresh token 延长会话
2. **密码强度验证** - 添加更严格的密码策略
3. **登录限制** - 实现登录失败次数限制
4. **记住我功能** - 延长 Token 有效期
5. **邮箱验证** - 注册时发送验证邮件
6. **密码重置** - 忘记密码功能

